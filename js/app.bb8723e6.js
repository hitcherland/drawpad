(function(n){function t(t){for(var o,c,r=t[0],u=t[1],l=t[2],f=0,d=[];f<r.length;f++)c=r[f],i[c]&&d.push(i[c][0]),i[c]=0;for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&(n[o]=u[o]);s&&s(t);while(d.length)d.shift()();return a.push.apply(a,l||[]),e()}function e(){for(var n,t=0;t<a.length;t++){for(var e=a[t],o=!0,r=1;r<e.length;r++){var u=e[r];0!==i[u]&&(o=!1)}o&&(a.splice(t--,1),n=c(c.s=e[0]))}return n}var o={},i={app:0},a=[];function c(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,c),e.l=!0,e.exports}c.m=n,c.c=o,c.d=function(n,t,e){c.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:e})},c.r=function(n){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},c.t=function(n,t){if(1&t&&(n=c(n)),8&t)return n;if(4&t&&"object"===typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(c.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)c.d(e,o,function(t){return n[t]}.bind(null,o));return e},c.n=function(n){var t=n&&n.__esModule?function(){return n["default"]}:function(){return n};return c.d(t,"a",t),t},c.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},c.p="/drawpad/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],u=r.push.bind(r);r.push=t,r=r.slice();for(var l=0;l<r.length;l++)t(r[l]);var s=u;a.push([0,"chunk-vendors"]),e()})({0:function(n,t,e){n.exports=e("56d7")},"034f":function(n,t,e){"use strict";var o=e("64a9"),i=e.n(o);i.a},1:function(n,t){},"56d7":function(n,t,e){"use strict";e.r(t);e("cadf"),e("551c"),e("f751"),e("097d");var o,i=e("2b0e"),a=e("5f5b"),c=e("7591"),r=e.n(c),u=e("ec02"),l=e.n(u),s=e("468d"),f=e.n(s),d=e("03cd"),_=e.n(d),h=(e("2fac"),e("f9e3"),e("2dd8"),function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",{on:{keydown:[function(t){return!t.type.indexOf("key")&&n._k(t.keyCode,"z",void 0,t.key,void 0)?null:t.ctrlKey?n.undo(t):null},function(t){return!t.type.indexOf("key")&&n._k(t.keyCode,"r",void 0,t.key,void 0)?null:t.ctrlKey?(t.preventDefault(),n.redo(t)):null}]}},[e("vue-headful",{attrs:{title:"drawpg",description:"drawing rpg platform"}}),e("fullscreen",{ref:"fullscreen",on:{change:n.fullscreenChange}},[e("v-stage",{ref:"canvas",attrs:{tabindex:"0",config:n.configKonva},on:{mousedown:n.onPointerDown,mousemove:n.onPointerDrag,mouseup:n.onPointerUp,touchstart:n.onPointerDown,touchmove:n.onPointerDrag,touchend:n.onPointerUp}},[e("v-layer",n._l(n.paths,function(n){return e("v-path",{key:n.id,attrs:{config:n}})}),1)],1),e("div",{staticClass:"top-right"},[e("swatches",{attrs:{colors:"text-advanced","popover-to":"left"},on:{input:n.setStrokeColor},model:{value:n.configPalette.stroke,callback:function(t){n.$set(n.configPalette,"stroke",t)},expression:"configPalette.stroke"}}),e("swatches",{attrs:{colors:"text-advanced","popover-to":"left"},on:{input:n.setFillColor},model:{value:n.configPalette.fill,callback:function(t){n.$set(n.configPalette,"fill",t)},expression:"configPalette.fill"}})],1),e("button",{staticClass:"bottom-right",attrs:{type:"button"},on:{click:n.toggleFullscreen}},[n._v("Fullscreen")])],1)],1)}),v=[],p=(e("ac6a"),e("6c7b"),e("ac4d"),e("8a81"),e("8615"),e("8055")),g=e.n(p),y={},w={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},m=g()("wss://hitcher.land:3001"),x=function(n){m.on("join",function(t){n(t)})},b=function(n){m.on("signaling",function(t){n(t)})},k=function(n,t){m.emit(n,t)},P=function(n){m.on("ice-candidate",function(t){n(t)})},C=function(){};function D(n){C=n}function O(n){var t;function e(){}return void 0===n?o=t={}:y[n]=t={},t.id=n,t.connection=new RTCPeerConnection(w),t.out_channel=t.connection.createDataChannel("drawpg"),t.in_channel=void 0,t.connection.onicecandidate=function(n){void 0!==t.id&&k("ice-candidate",{target:t.id,candidate:n.candidate})},t.connection.onnegotiationneeded=function(){"have-local-offer"!=t.connection.signalingState&&"have-remote-offer"!=t.connection.signalingState&&t.connection.createOffer().then(function(n){return t.connection.setLocalDescription(n)}).then(function(){var n={type:"offer",target:t.id||"all",sdp:t.connection.localDescription};k("signaling",n)})},t.out_channel.onopen=e,t.out_channel.onclose=e,t.connection.ondatachannel=function(n){function e(n){C(JSON.parse(n.data))}function o(){}t.in_channel=n.channel,t.in_channel.onmessage=e,t.in_channel.onopen=o,t.in_channel.onclose=o},t}function S(n){var t=JSON.stringify(n);Object.values(y).forEach(function(n){return n.out_channel.send(t)})}x(function(n){var t=!0,e=!1,o=void 0;try{for(var i,a=n.ids[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var c=i.value;O(c)}}catch(r){e=!0,o=r}finally{try{t||null==a.return||a.return()}finally{if(e)throw o}}}),b(function(n){var t,e=n.responder;void 0===y[e]&&void 0===o?y[e]=t=O(e):void 0!==o?(t=o,o=void 0,y[e]=t):t=y[e];var i=t.connection,a=new RTCSessionDescription(n.sdp);null===i.localDescription?i.setRemoteDescription(a).then(function(){return i.createAnswer()}).then(function(n){return i.setLocalDescription(n)}).then(function(){var t={type:"answer",target:n.responder,sdp:i.localDescription};k("signaling",t)}):i.setRemoteDescription(a)}),P(function(n){var t=new RTCIceCandidate(n.candidate);y[n.responder].connection.addIceCandidate(t)});e("7f7f");var M=e("f029"),j=null,R=null,T=1,K=1,L={pencil:{name:"pencil",__active__:null,start:function(n,t){var e={uuid:M["a"].v4(),x:n,y:t,data:"M0,0",fill:null,stroke:j,__origin__:{x:n,y:t}};return this.__active__=e,{action:"create",path:e}},drag:function(n,t){var e=n-this.__active__.__origin__.x,o=t-this.__active__.__origin__.y,i=this.__active__.data+"L".concat(e,",").concat(o);return{action:"replace data",uuid:this.__active__.uuid,data:i}},stop:function(n,t){var e=n-this.__active__.__origin__.x,o=t-this.__active__.__origin__.y,i=this.__active__.data+"L".concat(e,",").concat(o),a=this.__active__.uuid;return this.__active__=void 0,{action:"replace data",uuid:a,data:i}}},loop:{name:"loop",__active__:null,start:function(n,t){var e={uuid:M["a"].v4(),x:n,y:t,data:"M0,0",fill:R,stroke:j,__origin__:{x:n,y:t}};return this.__active__=e,{action:"create",path:e}},drag:function(n,t){var e=n-this.__active__.__origin__.x,o=t-this.__active__.__origin__.y,i=this.__active__.data+"L".concat(e,",").concat(o);return{action:"replace data",uuid:this.__active__.uuid,data:i}},stop:function(n,t){var e=n-this.__active__.__origin__.x,o=t-this.__active__.__origin__.y,i=this.__active__.data+"L".concat(e,",").concat(o),a=this.__active__.uuid;return this.__active__=void 0,{action:"replace data",uuid:a,data:i}}}},z=L.pencil,F=!1;function $(n){var t=n;void 0!==t.changedTouches&&t.changedTouches.length>0&&(t=t.changedTouches[0]);var e=t.pageX/T,o=t.pageY/K;return{x:e,y:o}}function E(n){F=!0;var t=$(n.evt),e=z.start.call(z,t.x,t.y);return e.tool=z.name,e}function J(n){if(F){var t=$(n.evt),e=z.drag.call(z,t.x,t.y);return e.tool=z.name,e}}function U(n){F=!1;var t=$(n.evt),e=z.stop.call(z,t.x,t.y);return e.tool=z.name,e}function X(n){j=n}function Y(n){R=n}function I(n,t){T=n,K=t}var N={data:function(){return{fullscreen:!1,paths:[],configKonva:{width:1024,height:600,scaleX:1,scaleY:1},resolution:{x:1024,y:600},configPalette:{stroke:"#000000",fill:null}}},created:function(){window.addEventListener("resize",this.handleResize),this.handleResize(),D(this.onMessage),X(this.configPalette.stroke),Y(this.configPalette.fill)},mounted:function(){},methods:{fullscreenChange:function(n){this.fullscreen=n,this.handleResize()},toggleFullscreen:function(){this.$refs["fullscreen"].toggle()},onMessage:function(n){"create"==n.action?this.paths.push(n.path):"replace data"==n.action&&this.paths.filter(function(t){return t.uuid==n.uuid}).forEach(function(t){return t.data=n.data})},handleResize:function(){this.resolution.y,this.resolution.x;var n=window.innerWidth,t=window.innerHeight,e=n/this.resolution.x,o=t/this.resolution.y,i=Math.min(e,o);I(i,i),this.configKonva.width=this.resolution.x*i,this.configKonva.height=this.resolution.y*i,this.configKonva.scaleX=i,this.configKonva.scaleY=i},setStrokeColor:function(n){X(n)},setFillColor:function(n){X(n)},onPointerDown:function(n){console.log("down");var t=E(n);console.log("command",t),void 0!==t&&(this.onMessage(t),S(t))},onPointerDrag:function(n){var t=J(n);void 0!==t&&(this.onMessage(t),S(t))},onPointerUp:function(n){var t=U(n);void 0!==t&&(this.onMessage(t),S(t))},undo:function(){this.paths.length>0&&this.undos.push(this.paths.pop())},redo:function(){this.undos.length>0&&this.paths.push(this.undos.pop())}}},A=N,H=(e("034f"),e("2877")),W=Object(H["a"])(A,h,v,!1,null,null,null),q=W.exports;i["default"].use(_.a),i["default"].use(a["a"]),i["default"].use(r.a),i["default"].component("vue-headful",l.a),i["default"].component("Swatches",f.a),i["default"].config.productionTip=!1,new i["default"]({render:function(n){return n(q)}}).$mount("#app")},"64a9":function(n,t,e){}});
//# sourceMappingURL=app.bb8723e6.js.map